<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>遮罩弹出框</title>
<style type="text/css">
	*{ padding:0px; margin:0px; list-style:none;}
	body{ height:2000px;}
	#bigDiv{ background:#000; opacity:0.5; filter:alpha(opacity:50); position:absolute; z-index:1; top:0; left:0;}
	#div1{ width:300px; height:300px; position:absolute; border:1px solid red; background:#CCCCCC;  z-index:2; cursor:move;}
	#div1 span{ color:#FFFFFF; font-size:18px; font-weight:bold; cursor:pointer;}
</style>
<script type="text/javascript">
	window.onload=function()
	{
		var oBtn=document.getElementById('btn');
		oBtn.onclick=function()
		{
			var oDiv=document.createElement('div');
			var oBody=document.getElementsByTagName('body')[0];
			var clientWidth=document.documentElement.clientWidth;
			var clientHeight=document.documentElement.clientHeight;
			oBody.appendChild(oDiv);
			oDiv.id="div1";
			oDiv.innerHTML="<span>x</span>";
			oDiv.style.left=(clientWidth-oDiv.offsetWidth)/2+"px";
			oDiv.style.top=(clientHeight-oDiv.offsetHeight)/2+"px";
			var oDiv=document.createElement('div');
			oBody.appendChild(oDiv);
			oDiv.id="bigDiv";
			oDiv.style.width=clientWidth+"px";
			oDiv.style.height=clientHeight+"px";
			var oDiv1=document.getElementById('div1');
			var disX=0;
			var disY=0;
			oDiv1.onmousedown=function(ev)
			{
				oEvent=ev||event;
				disX=oEvent.clientX-oDiv1.offsetLeft;
				disY=oEvent.clientY-oDiv1.offsetTop;
				if(oDiv1.setCapture)
				{
					oDiv1.setCapture();
				}
				document.onmousemove=function(ev)
				{
					oEvent=ev||event;
					var l=oEvent.clientX-disX;
					var t=oEvent.clientY-disY;
					var clientWidth=document.documentElement.clientWidth;
					var clientHeight=document.documentElement.clientHeight;
					if(l>clientWidth-oDiv1.offsetWidth)
					{
						l = clientWidth-oDiv1.offsetWidth;
					}
					if(l<0)
					{
						l=0;
					}
					if(t>clientHeight-oDiv1.offsetHeight)
					{
						t=clientHeight-oDiv1.offsetHeight;
					}
					if(t<0)
					{
						t=0;
					}
					oDiv1.style.left=l+"px";
					oDiv1.style.top=t+"px"
				}
				document.onmouseup=function()
				{
					document.onmousemove=null;
					document.onmouseup=null;
					if(oDiv1.releaseCapture)
					{
						oDiv1.releaseCapture();
					}
				}
			}
			var oSpan=oDiv1.getElementsByTagName('span')[0];
			var oBigDiv=document.getElementById('bigDiv');
			oSpan.onclick=function()
			{
				oDiv1.style.display="none";
				oBigDiv.style.display="none";
				oBody.removeChild(oDiv1);
				oBody.removeChild(oBigDiv);
			};
			window.onscroll=window.onresize=function()
			{
				var oScrollTop=document.documentElement.scrollTop||document.body.scrollTop;
				var clientWidth=document.documentElement.clientWidth;
				var clientHeight=document.documentElement.clientHeight;
				oBigDiv.style.width=clientWidth+"px";
				oBigDiv.style.height=clientHeight+oScrollTop+"px";
				oDiv1.style.top=oScrollTop+(clientHeight-oDiv1.offsetHeight)/2;
			}
		}
	};
</script>
</head>
<body>
	<input type="button" value="按钮" id="btn" />
</body>
</html>
